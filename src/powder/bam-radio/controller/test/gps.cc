#include "../src/gps.h"
#include "../src/events.h"
#include "../src/notify.h"

#include <fstream>
#include <iostream>

#include <signal.h>
#include <sys/types.h>
#include <unistd.h>

const char *fakedata =
    "$GPGGA,174322,3759.0048,N,02331.5007,E,1,04,5.6,965.1,M,34.5,M,,*48\n"
    "$GPRMC,174322,A,3759.0048,N,02331.5007,E,19417.0,187.9,240817,5,E,A*1\n"
    "$GPGGA,174324,3748.3267,N,02333.7812,E,1,04,5.6,593.3,M,34.5,M,,*49\n"
    "$GPRMC,174324,A,3748.3267,N,02333.7812,E,19491.7,170.4,240817,5,E,A*B\n"
    "$GPGGA,174326,3739.2231,N,02339.9360,E,1,04,5.6,280.7,M,34.5,M,,*44\n"
    "$GPRMC,174326,A,3739.2231,N,02339.9360,E,18582.0,151.8,240817,5,E,A*D\n"
    "$GPGGA,174328,3733.0499,N,02349.1114,E,1,04,5.6,72.8,M,34.5,M,,*78\n"
    "$GPRMC,174328,A,3733.0499,N,02349.1114,E,17166.5,130.3,240817,5,E,A*9\n"
    "$GPGGA,174330,3730.7500,N,02400.0000,E,1,04,5.6,0.0,M,34.5,M,,*46\n"
    "$GPRMC,174330,A,3730.7500,N,02400.0000,E,16084.5,104.9,240817,5,E,A*B\n"
    "$GPGGA,174332,3732.7099,N,02411.0259,E,1,04,5.6,72.8,M,34.5,M,,*70\n"
    "$GPRMC,174332,A,3732.7099,N,02411.0259,E,16129.8,77.3,240817,5,E,A*34\n"
    "$GPGGA,174334,3738.6956,N,02420.5735,E,1,04,5.6,280.7,M,34.5,M,,*4F\n"
    "$GPRMC,174334,A,3738.6956,N,02420.5735,E,17363.8,51.6,240817,5,E,A*37\n"
    "$GPGGA,174336,3747.8792,N,02427.2237,E,1,04,5.6,593.3,M,34.5,M,,*4B\n"
    "$GPRMC,174336,A,3747.8792,N,02427.2237,E,19050.3,29.8,240817,5,E,A*35\n"
    "$GPGGA,174338,3758.9536,N,02429.9651,E,1,04,5.6,965.1,M,34.5,M,,*40\n"
    "$GPRMC,174338,A,3758.9536,N,02429.9651,E,20310.7,11.0,240817,5,E,A*33\n"
    "$GPGGA,174340,3800.0570,N,02400.1566,E,1,04,5.6,1342.0,M,34.5,M,,*7D\n"
    "$GPRMC,174340,A,3800.0570,N,02400.1566,E,42332.2,272.8,240817,5,E,A*F\n"
    "$GPGGA,174342,3800.2342,N,02400.2601,E,1,04,5.6,1669.1,M,34.5,M,,*76\n"
    "$GPRMC,174342,A,3800.2342,N,02400.2601,E,351.1,24.7,240817,5,E,A*37\n"
    "$GPGGA,174344,3800.4794,N,02400.2338,E,1,04,5.6,1898.8,M,34.5,M,,*7F\n"
    "$GPRMC,174344,A,3800.4794,N,02400.2338,E,442.9,355.2,240817,5,E,A*A\n"
    "$GPGGA,174346,3800.7149,N,02400.0500,E,1,04,5.6,1997.6,M,34.5,M,,*77\n"
    "$GPRMC,174346,A,3800.7149,N,02400.0500,E,497.7,328.4,240817,5,E,A*8\n"
    "$GPGGA,174348,3800.8560,N,02359.7219,E,1,04,5.6,1951.1,M,34.5,M,,*77\n"
    "$GPRMC,174348,A,3800.8560,N,02359.7219,E,530.1,298.6,240817,5,E,A*7\n"
    "$GPGGA,174350,3800.8299,N,02359.3036,E,1,04,5.6,1766.0,M,34.5,M,,*7F\n"
    "$GPRMC,174350,A,3800.8299,N,02359.3036,E,595.0,265.5,240817,5,E,A*B\n"
    "$GPGGA,174352,3800.5947,N,02358.8816,E,1,04,5.6,1469.5,M,34.5,M,,*71\n"
    "$GPRMC,174352,A,3800.5947,N,02358.8816,E,733.2,234.7,240817,5,E,A*6\n"
    "$GPGGA,174354,3800.1516,N,02358.5579,E,1,04,5.6,1104.5,M,34.5,M,,*7C\n"
    "$GPRMC,174354,A,3800.1516,N,02358.5579,E,920.2,209.9,240817,5,E,A*9\n"
    "$GPGGA,174356,3759.5498,N,02358.4299,E,1,04,5.6,724.4,M,34.5,M,,*42\n"
    "$GPRMC,174356,A,3759.5498,N,02358.4299,E,1098.3,189.5,240817,5,E,A*3E\n"
    "$GPGGA,174358,3758.8815,N,02358.5684,E,1,04,5.6,384.3,M,34.5,M,,*49\n"
    "$GPRMC,174358,A,3758.8815,N,02358.5684,E,1218.8,170.7,240817,5,E,A*39\n"
    "$GPGGA,174400,3758.2679,N,02359.0000,E,1,04,5.6,134.0,M,34.5,M,,*49\n"
    "$GPRMC,174400,A,3758.2679,N,02359.0000,E,1262.9,151.0,240817,5,E,A*3B\n"
    "$GPGGA,174402,3757.8379,N,02359.6961,E,1,04,5.6,9.7,M,34.5,M,,*4B\n"
    "$GPRMC,174402,A,3757.8379,N,02359.6961,E,1255.0,128.1,240817,5,E,A*33\n"
    "$GPGGA,174404,3757.7036,N,02400.5725,E,1,04,5.6,29.7,M,34.5,M,,*7E\n"
    "$GPRMC,174404,A,3757.7036,N,02400.5725,E,1267.0,101.0,240817,5,E,A*3F\n"
    "$GPGGA,174406,3757.9370,N,02401.4989,E,1,04,5.6,191.0,M,34.5,M,,*4E\n"
    "$GPRMC,174406,A,3757.9370,N,02401.4989,E,1380.0,72.3,240817,5,E,A*4\n"
    "$GPGGA,174408,3758.5516,N,02402.3180,E,1,04,5.6,470.1,M,34.5,M,,*4B\n"
    "$GPRMC,174408,A,3758.5516,N,02402.3180,E,1604.6,46.4,240817,5,E,A*5\n"
    "$GPGGA,174410,3759.4935,N,02402.8724,E,1,04,5.6,826.4,M,34.5,M,,*46\n"
    "$GPRMC,174410,A,3759.4935,N,02402.8724,E,1869.1,24.9,240817,5,E,A*9\n"
    "$GPGGA,174412,3800.6445,N,02403.0323,E,1,04,5.6,1207.9,M,34.5,M,,*70\n"
    "$GPRMC,174412,A,3800.6445,N,02403.0323,E,2084.2,6.2,240817,5,E,A*3A\n"
    "$GPGGA,174414,3801.8360,N,02402.7220,E,1,04,5.6,1559.2,M,34.5,M,,*7A\n"
    "$GPRMC,174414,A,3801.8360,N,02402.7220,E,2189.3,348.4,240817,5,E,A*35\n"
    "$GPGGA,174416,3802.8740,N,02401.9385,E,1,04,5.6,1829.0,M,34.5,M,,*76\n"
    "$GPRMC,174416,A,3802.8740,N,02401.9385,E,2173.6,329.3,240817,5,E,A*31\n"
    "$GPGGA,174418,3803.5702,N,02400.7589,E,1,04,5.6,1978.1,M,34.5,M,,*73\n"
    "$GPRMC,174418,A,3803.5702,N,02400.7589,E,2089.6,306.9,240817,5,E,A*33\n"
    "$GPGGA,174420,3803.7751,N,02359.3343,E,1,04,5.6,1984.8,M,34.5,M,,*79\n"
    "$GPRMC,174420,A,3803.7751,N,02359.3343,E,2052.3,280.4,240817,5,E,A*32\n"
    "$GPGGA,174422,3803.4063,N,02357.8715,E,1,04,5.6,1848.0,M,34.5,M,,*75\n"
    "$GPRMC,174422,A,3803.4063,N,02357.8715,E,2176.9,252.3,240817,5,E,A*32\n"
    "$GPGGA,174424,3802.4687,N,02356.6021,E,1,04,5.6,1587.8,M,34.5,M,,*77\n"
    "$GPRMC,174424,A,3802.4687,N,02356.6021,E,2467.0,226.8,240817,5,E,A*32\n"
    "$GPGGA,174426,3801.0604,N,02355.7469,E,1,04,5.6,1241.9,M,34.5,M,,*7F\n"
    "$GPRMC,174426,A,3801.0604,N,02355.7469,E,2810.0,205.6,240817,5,E,A*35\n"
    "$GPGGA,174428,3759.3644,N,02355.4778,E,1,04,5.6,860.8,M,34.5,M,,*4D\n"
    "$GPRMC,174428,A,3759.3644,N,02355.4778,E,3076.5,187.1,240817,5,E,A*3C\n"
    "$GPGGA,174430,3757.6250,N,02355.8864,E,1,04,5.6,500.0,M,34.5,M,,*43\n"
    "$GPRMC,174430,A,3757.6250,N,02355.8864,E,3184.2,169.5,240817,5,E,A*3E\n"
    "$GPGGA,174432,3756.1125,N,02356.9627,E,1,04,5.6,212.0,M,34.5,M,,*49\n"
    "$GPRMC,174432,A,3756.1125,N,02356.9627,E,3121.9,150.7,240817,5,E,A*3C\n"
    "$GPGGA,174434,3755.0815,N,02358.5897,E,1,04,5.6,38.7,M,34.5,M,,*7D\n"
    "$GPRMC,174434,A,3755.0815,N,02358.5897,E,2963.0,128.8,240817,5,E,A*33\n"
    "$GPGGA,174436,3754.7290,N,02400.5540,E,1,04,5.6,5.5,M,34.5,M,,*4F\n"
    "$GPRMC,174436,A,3754.7290,N,02400.5540,E,2860.7,102.8,240817,5,E,A*30\n"
    "$GPGGA,174438,3755.1585,N,02402.5743,E,1,04,5.6,117.1,M,34.5,M,,*40\n"
    "$GPRMC,174438,A,3755.1585,N,02402.5743,E,2971.2,74.9,240817,5,E,A*C\n"
    "$GPGGA,174440,3756.3575,N,02404.3409,E,1,04,5.6,357.2,M,34.5,M,,*49\n"
    "$GPRMC,174440,A,3756.3575,N,02404.3409,E,3309.0,49.3,240817,5,E,A*2\n"
    "$GPGGA,174442,3758.1923,N,02405.5637,E,1,04,5.6,691.0,M,34.5,M,,*4D\n"
    "$GPRMC,174442,A,3758.1923,N,02405.5637,E,3730.7,27.7,240817,5,E,A*E\n"
    "$GPGGA,174444,3800.4209,N,02406.0186,E,1,04,5.6,1069.8,M,34.5,M,,*7C\n"
    "$GPRMC,174444,A,3800.4209,N,02406.0186,E,4063.1,9.1,240817,5,E,A*3D\n"
    "$GPGGA,174446,3802.7252,N,02405.5875,E,1,04,5.6,1438.4,M,34.5,M,,*7E\n"
    "$GPRMC,174446,A,3802.7252,N,02405.5875,E,4192.6,351.6,240817,5,E,A*32\n"
    "$GPGGA,174448,3804.7561,N,02404.2824,E,1,04,5.6,1743.1,M,34.5,M,,*79\n"
    "$GPRMC,174448,A,3804.7561,N,02404.2824,E,4096.9,333.2,240817,5,E,A*35\n"
    "$GPGGA,174450,3806.1863,N,02402.2516,E,1,04,5.6,1939.7,M,34.5,M,,*74\n"
    "$GPRMC,174450,A,3806.1863,N,02402.2516,E,3860.6,311.8,240817,5,E,A*3E\n"
    "$GPGGA,174452,3806.7625,N,02359.7638,E,1,04,5.6,1999.4,M,34.5,M,,*76\n"
    "$GPRMC,174452,A,3806.7625,N,02359.7638,E,3673.0,286.4,240817,5,E,A*3C\n"
    "$GPGGA,174454,3806.3491,N,02357.1732,E,1,04,5.6,1913.5,M,34.5,M,,*79\n"
    "$GPRMC,174454,A,3806.3491,N,02357.1732,E,3743.9,258.5,240817,5,E,A*39\n"
    "$GPGGA,174456,3804.9552,N,02354.8687,E,1,04,5.6,1694.7,M,34.5,M,,*7A\n"
    "$GPRMC,174456,A,3804.9552,N,02354.8687,E,4117.3,232.5,240817,5,E,A*3E\n"
    "$GPGGA,174458,3802.7409,N,02353.2161,E,1,04,5.6,1374.6,M,34.5,M,,*7B\n"
    "$GPRMC,174458,A,3802.7409,N,02353.2161,E,4623.0,210.4,240817,5,E,A*37\n"
    "$GPGGA,174500,3800.0000,N,02352.5000,E,1,04,5.6,1000.0,M,34.5,M,,*79\n"
    "$GPRMC,174500,A,3800.0000,N,02352.5000,E,5037.0,191.6,240817,5,E,A*39\n"
    "$GPGGA,174502,3757.1218,N,02352.8761,E,1,04,5.6,625.4,M,34.5,M,,*45\n"
    "$GPRMC,174502,A,3757.1218,N,02352.8761,E,5208.2,174.1,240817,5,E,A*31\n"
    "$GPGGA,174504,3754.5354,N,02354.3412,E,1,04,5.6,305.3,M,34.5,M,,*47\n"
    "$GPRMC,174504,A,3754.5354,N,02354.3412,E,5099.1,155.9,240817,5,E,A*31\n"
    "$GPGGA,174506,3752.6460,N,02356.7258,E,1,04,5.6,86.5,M,34.5,M,,*70\n"
    "$GPRMC,174506,A,3752.6460,N,02356.7258,E,4800.0,135.1,240817,5,E,A*3E\n"
    "$GPGGA,174508,3751.7717,N,02359.7127,E,1,04,5.6,0.6,M,34.5,M,,*46\n"
    "$GPRMC,174508,A,3751.7717,N,02359.7127,E,4526.5,110.3,240817,5,E,A*3C\n"
    "$GPGGA,174510,3752.0909,N,02402.8787,E,1,04,5.6,60.3,M,34.5,M,,*73\n"
    "$GPRMC,174510,A,3752.0909,N,02402.8787,E,4535.5,82.7,240817,5,E,A*6\n"
    "$GPGGA,174512,3753.6090,N,02405.7545,E,1,04,5.6,256.9,M,34.5,M,,*46\n"
    "$GPRMC,174512,A,3753.6090,N,02405.7545,E,4915.3,56.2,240817,5,E,A*A\n"
    "$GPGGA,174514,3756.1496,N,02407.8944,E,1,04,5.6,561.6,M,34.5,M,,*4C\n"
    "$GPRMC,174514,A,3756.1496,N,02407.8944,E,5490.8,33.6,240817,5,E,A*1\n"
    "$GPGGA,174516,3759.3745,N,02408.9448,E,1,04,5.6,930.2,M,34.5,M,,*4D\n"
    "$GPRMC,174516,A,3759.3745,N,02408.9448,E,5993.1,14.4,240817,5,E,A*C\n"
    "$GPGGA,174518,3802.8275,N,02408.7022,E,1,04,5.6,1309.0,M,34.5,M,,*7A\n"
    "$GPRMC,174518,A,3802.8275,N,02408.7022,E,6224.9,356.8,240817,5,E,A*3D\n"
    "$GPGGA,174520,3805.9994,N,02407.1497,E,1,04,5.6,1642.8,M,34.5,M,,*72\n"
    "$GPRMC,174520,A,3805.9994,N,02407.1497,E,6118.4,338.9,240817,5,E,A*3F\n"
    "$GPGGA,174522,3808.4027,N,02404.4678,E,1,04,5.6,1882.9,M,34.5,M,,*77\n"
    "$GPRMC,174522,A,3808.4027,N,02404.4678,E,5756.6,318.7,240817,5,E,A*38\n"
    "$GPGGA,174524,3809.6469,N,02401.0139,E,1,04,5.6,1994.5,M,34.5,M,,*75\n"
    "$GPRMC,174524,A,3809.6469,N,02401.0139,E,5377.5,294.6,240817,5,E,A*30\n"
    "$GPGGA,174526,3809.5005,N,02357.2758,E,1,04,5.6,1961.3,M,34.5,M,,*71\n"
    "$GPRMC,174526,A,3809.5005,N,02357.2758,E,5297.3,267.2,240817,5,E,A*39\n"
    "$GPGGA,174528,3807.9326,N,02353.8023,E,1,04,5.6,1788.0,M,34.5,M,,*70\n"
    "$GPRMC,174528,A,3807.9326,N,02353.8023,E,5669.3,240.2,240817,5,E,A*32\n"
    "$GPGGA,174530,3805.1250,N,02351.1232,E,1,04,5.6,1500.0,M,34.5,M,,*78\n"
    "$GPRMC,174530,A,3805.1250,N,02351.1232,E,6319.7,216.9,240817,5,E,A*35\n"
    "$GPGGA,174532,3801.4520,N,02349.6682,E,1,04,5.6,1139.2,M,34.5,M,,*76\n"
    "$GPRMC,174532,A,3801.4520,N,02349.6682,E,6925.5,197.3,240817,5,E,A*30\n"
    "$GPGGA,174534,3757.4316,N,02349.6987,E,1,04,5.6,758.1,M,34.5,M,,*46\n"
    "$GPRMC,174534,A,3757.4316,N,02349.6987,E,7236.9,179.7,240817,5,E,A*33\n"
    "$GPGGA,174536,3753.6519,N,02351.2626,E,1,04,5.6,412.2,M,34.5,M,,*4C\n"
    "$GPRMC,174536,A,3753.6519,N,02351.2626,E,7156.6,161.9,240817,5,E,A*3A\n"
    "$GPGGA,174538,3750.6856,N,02354.1797,E,1,04,5.6,152.0,M,34.5,M,,*49\n"
    "$GPRMC,174538,A,3750.6856,N,02354.1797,E,6759.4,142.2,240817,5,E,A*3C\n"
    "$GPGGA,174540,3749.0030,N,02358.0609,E,1,04,5.6,15.2,M,34.5,M,,*7B\n"
    "$GPRMC,174540,A,3749.0030,N,02358.0609,E,6294.4,118.7,240817,5,E,A*30\n"
    "$GPGGA,174542,3748.8980,N,02402.3598,E,1,04,5.6,21.9,M,34.5,M,,*7E\n"
    "$GPRMC,174542,A,3748.8980,N,02402.3598,E,6115.8,91.7,240817,5,E,A*F\n"
    "$GPGGA,174544,3750.4384,N,02406.4494,E,1,04,5.6,171.0,M,34.5,M,,*40\n"
    "$GPRMC,174544,A,3750.4384,N,02406.4494,E,6441.6,64.5,240817,5,E,A*E\n"
    "$GPGGA,174546,3753.4481,N,02409.7136,E,1,04,5.6,440.8,M,34.5,M,,*4D\n"
    "$GPRMC,174546,A,3753.4481,N,02409.7136,E,7131.9,40.6,240817,5,E,A*5\n"
    "$GPGGA,174548,3757.5259,N,02411.6400,E,1,04,5.6,792.1,M,34.5,M,,*48\n"
    "$GPRMC,174548,A,3757.5259,N,02411.6400,E,7833.0,20.4,240817,5,E,A*3\n"
    "$GPGGA,174550,3802.0982,N,02411.8998,E,1,04,5.6,1173.6,M,34.5,M,,*7B\n"
    "$GPRMC,174550,A,3802.0982,N,02411.8998,E,8238.6,2.6,240817,5,E,A*35\n"
    "$GPGGA,174552,3806.5003,N,02410.4027,E,1,04,5.6,1529.9,M,34.5,M,,*7C\n"
    "$GPRMC,174552,A,3806.5003,N,02410.4027,E,8202.8,345.0,240817,5,E,A*37\n"
    "$GPGGA,174554,3810.0723,N,02407.3179,E,1,04,5.6,1809.0,M,34.5,M,,*70\n"
    "$GPRMC,174554,A,3810.0723,N,02407.3179,E,7772.5,325.8,240817,5,E,A*33\n"
    "$GPGGA,174556,3812.2581,N,02403.0563,E,1,04,5.6,1970.3,M,34.5,M,,*7C\n"
    "$GPRMC,174556,A,3812.2581,N,02403.0563,E,7199.6,303.1,240817,5,E,A*3E\n"
    "$GPGGA,174558,3812.6919,N,02358.2163,E,1,04,5.6,1990.3,M,34.5,M,,*7A\n"
    "$GPRMC,174558,A,3812.6919,N,02358.2163,E,6890.1,276.5,240817,5,E,A*37\n"
    "$GPGGA,174600,3811.2583,N,02353.5000,E,1,04,5.6,1866.0,M,34.5,M,,*7F\n"
    "$GPRMC,174600,A,3811.2583,N,02353.5000,E,7153.1,248.9,240817,5,E,A*3F\n"
    "$GPGGA,174602,3808.1165,N,02349.6114,E,1,04,5.6,1615.7,M,34.5,M,,*7B\n"
    "$GPRMC,174602,A,3808.1165,N,02349.6114,E,7891.2,224.2,240817,5,E,A*33\n"
    "$GPGGA,174604,3803.6844,N,02347.1511,E,1,04,5.6,1275.6,M,34.5,M,,*70\n"
    "$GPRMC,174604,A,3803.6844,N,02347.1511,E,8705.8,203.6,240817,5,E,A*3D\n"
    "$GPGGA,174606,3758.5836,N,02346.5242,E,1,04,5.6,895.5,M,34.5,M,,*47\n"
    "$GPRMC,174606,A,3758.5836,N,02346.5242,E,9224.2,185.5,240817,5,E,A*3F\n"
    "$GPGGA,174608,3753.5526,N,02347.8742,E,1,04,5.6,530.5,M,34.5,M,,*45\n"
    "$GPRMC,174608,A,3753.5526,N,02347.8742,E,9256.5,168.0,240817,5,E,A*3B\n"
    "$GPGGA,174610,3749.3392,N,02351.0545,E,1,04,5.6,234.0,M,34.5,M,,*44\n"
    "$GPRMC,174610,A,3749.3392,N,02351.0545,E,8828.8,149.2,240817,5,E,A*32\n"
    "$GPGGA,174612,3746.5901,N,02355.6429,E,1,04,5.6,48.9,M,34.5,M,,*76\n"
    "$GPRMC,174612,A,3746.5901,N,02355.6429,E,8189.9,127.1,240817,5,E,A*38\n"
    "$GPGGA,174614,3745.7515,N,02400.9964,E,1,04,5.6,2.4,M,34.5,M,,*47\n"
    "$GPRMC,174614,A,3745.7515,N,02400.9964,E,7765.4,101.2,240817,5,E,A*3B\n"
    "$GPGGA,174616,3746.9974,N,02406.3418,E,1,04,5.6,101.2,M,34.5,M,,*4D\n"
    "$GPRMC,174616,A,3746.9974,N,02406.3418,E,7929.3,73.5,240817,5,E,A*7\n"
    "$GPGGA,174618,3750.1972,N,02410.8871,E,1,04,5.6,330.9,M,34.5,M,,*4E\n"
    "$GPRMC,174618,A,3750.1972,N,02410.8871,E,8657.6,48.3,240817,5,E,A*D\n"
    "$GPGGA,174620,3754.9267,N,02413.9388,E,1,04,5.6,658.0,M,34.5,M,,*4B\n"
    "$GPRMC,174620,A,3754.9267,N,02413.9388,E,9553.6,27.0,240817,5,E,A*6\n"
    "$GPGGA,174622,3800.5241,N,02415.0075,E,1,04,5.6,1034.9,M,34.5,M,,*75\n"
    "$GPRMC,174622,A,3800.5241,N,02415.0075,E,10188.8,8.6,240817,5,E,A*3\n"
    "$GPGGA,174624,3806.1824,N,02413.8859,E,1,04,5.6,1406.7,M,34.5,M,,*7B\n"
    "$GPRMC,174624,A,3806.1824,N,02413.8859,E,10308.3,351.1,240817,5,E,A*F\n"
    "$GPGGA,174626,3811.0658,N,02410.6862,E,1,04,5.6,1719.3,M,34.5,M,,*77\n"
    "$GPRMC,174626,A,3811.0658,N,02410.6862,E,9888.7,332.8,240817,5,E,A*39\n"
    "$GPGGA,174628,3814.4332,N,02405.8314,E,1,04,5.6,1927.2,M,34.5,M,,*73\n"
    "$GPRMC,174628,A,3814.4332,N,02405.8314,E,9158.7,311.5,240817,5,E,A*37\n"
    "$GPGGA,174630,3815.7500,N,02400.0000,E,1,04,5.6,2000.0,M,34.5,M,,*79\n"
    "$GPRMC,174630,A,3815.7500,N,02400.0000,E,8576.9,286.1,240817,5,E,A*3C\n"
    "$GPGGA,174632,3814.7731,N,02354.0313,E,1,04,5.6,1927.2,M,34.5,M,,*70\n"
    "$GPRMC,174632,A,3814.7731,N,02354.0313,E,8618.0,258.3,240817,5,E,A*3B\n"
    "$GPGGA,174634,3811.5934,N,02348.8044,E,1,04,5.6,1719.3,M,34.5,M,,*7C\n"
    "$GPRMC,174634,A,3811.5934,N,02348.8044,E,9348.5,232.3,240817,5,E,A*3D\n"
    "$GPGGA,174636,3806.6298,N,02345.1092,E,1,04,5.6,1406.7,M,34.5,M,,*70\n"
    "$GPRMC,174636,A,3806.6298,N,02345.1092,E,10352.8,210.4,240817,5,E,A*1\n"
    "$GPGGA,174638,3800.5753,N,02343.5267,E,1,04,5.6,1034.9,M,34.5,M,,*78\n"
    "$GPRMC,174638,A,3800.5753,N,02343.5267,E,11126.6,191.6,240817,5,E,A*4\n"
    "$GPGGA,174640,3754.2997,N,02344.3385,E,1,04,5.6,658.0,M,34.5,M,,*40\n"
    "$GPRMC,174640,A,3754.2997,N,02344.3385,E,11354.7,174.2,240817,5,E,A*1\n"
    "$GPGGA,174642,3748.7251,N,02347.4780,E,1,04,5.6,330.9,M,34.5,M,,*4C\n"
    "$GPRMC,174642,A,3748.7251,N,02347.4780,E,10981.4,156.0,240817,5,E,A*D\n"
    "$GPGGA,174644,3744.6905,N,02352.5331,E,1,04,5.6,101.2,M,34.5,M,,*4D\n"
    "$GPRMC,174644,A,3744.6905,N,02352.5331,E,10220.7,135.3,240817,5,E,A*2\n"
    "$GPGGA,174646,3742.8253,N,02358.7990,E,1,04,5.6,2.4,M,34.5,M,,*42\n"
    "$GPRMC,174646,A,3742.8253,N,02358.7990,E,9531.4,110.6,240817,5,E,A*37\n"
    "$GPGGA,174648,3743.4516,N,02405.3769,E,1,04,5.6,48.9,M,34.5,M,,*77\n"
    "$GPRMC,174648,A,3743.4516,N,02405.3769,E,9433.4,83.1,240817,5,E,A*E\n"
    "$GPGGA,174650,3746.5304,N,02411.3023,E,1,04,5.6,234.0,M,34.5,M,,*43\n"
    "$GPRMC,174650,A,3746.5304,N,02411.3023,E,10091.2,56.7,240817,5,E,A*36\n"
    "$GPGGA,174652,3751.6591,N,02415.6870,E,1,04,5.6,530.5,M,34.5,M,,*47\n"
    "$GPRMC,174652,A,3751.6591,N,02415.6870,E,11139.8,34.0,240817,5,E,A*3F\n"
    "$GPGGA,174654,3758.1237,N,02417.8517,E,1,04,5.6,895.5,M,34.5,M,,*46\n"
    "$GPRMC,174654,A,3758.1237,N,02417.8517,E,12035.5,14.8,240817,5,E,A*35\n"
    "$GPGGA,174656,3804.9982,N,02417.4309,E,1,04,5.6,1275.6,M,34.5,M,,*7C\n"
    "$GPRMC,174656,A,3804.9982,N,02417.4309,E,12388.5,357.2,240817,5,E,A*2\n"
    "$GPGGA,174658,3811.2769,N,02414.4337,E,1,04,5.6,1615.7,M,34.5,M,,*7B\n"
    "$GPRMC,174658,A,3811.2769,N,02414.4337,E,12071.9,339.4,240817,5,E,A*1\n"
    "$GPGGA,174700,3816.0215,N,02409.2500,E,1,04,5.6,1866.0,M,34.5,M,,*79\n"
    "$GPRMC,174700,A,3816.0215,N,02409.2500,E,11254.5,319.4,240817,5,E,A*6\n"
    "$GPGGA,174702,3818.5015,N,02402.6002,E,1,04,5.6,1990.3,M,34.5,M,,*71\n"
    "$GPRMC,174702,A,3818.5015,N,02402.6002,E,10401.7,295.4,240817,5,E,A*5\n"
    "$GPGGA,174704,3818.3062,N,02355.4357,E,1,04,5.6,1970.3,M,34.5,M,,*7B\n"
    "$GPRMC,174704,A,3818.3062,N,02355.4357,E,10125.7,268.0,240817,5,E,A*4\n"
    "$GPGGA,174706,3815.4118,N,02348.8027,E,1,04,5.6,1809.0,M,34.5,M,,*77\n"
    "$GPRMC,174706,A,3815.4118,N,02348.8027,E,10723.1,241.0,240817,5,E,A*9\n";

int main(int argc, char *argv[]) {
  // write fake data and start gpsfake program
  std::ofstream of("fake_data.gps", std::ios::out);
  of << fakedata << std::endl;
  of.close();
  std::cout << "In another terminal, start gpsfake:\n\tgpsfake -P 6000 -S "
               "fake_data.gps\n\nThen press [Enter]"
            << std::endl;
  std::cin.ignore();

  boost::asio::io_service ios;
  boost::posix_time::seconds ti(10);
  boost::asio::deadline_timer to(ios);

  bamradio::gps::GPSReader gps(6000);

  auto token = bamradio::NotificationCenter::shared
                   .subscribe<bamradio::gps::GPSEventInfo>(
                       bamradio::gps::GPSEvent, ios, [](auto const &ei) {
                         nlohmann::json eventJson = ei;
                         std::cout << eventJson << std::endl;
                       });

  auto stop = [&](auto, auto) {
    std::cerr << std::endl << "Shutting down exiting..." << std::endl;
    ios.stop();
  };

  boost::asio::signal_set signals(ios, SIGINT);
  signals.async_wait(stop);
  to.expires_from_now(ti);
  to.async_wait([&](auto &e) { stop(e, 0); });
  ios.run();
  return 0;
}
